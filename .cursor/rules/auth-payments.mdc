---
description: 
globs: 
alwaysApply: true
---
---
description: "Secure authentication and Stripe payment integration"
globs: **/api/**
---
# Authentication and Payment Integration
- Use a robust auth solution (e.g. NextAuth or Auth0) with OAuth or email login. Always hash passwords and use HTTPS. Store minimal PHI in user accounts.
- Protect pages by requiring authentication (e.g. `useSession()` or middleware). Ensure users only access their own data.
- For cookies or tokens: set `HttpOnly`, `Secure`, and `SameSite=Strict` where appropriate.
- Integrate Stripe (or similar) only on the server side. Do NOT include PHI in any payment metadata or webhook payloads:contentReference[oaicite:16]{index=16}.
- Verify all Stripe webhooks with the official signature secret:contentReference[oaicite:17]{index=17}. Store Stripe keys in environment variables (never in source).
- Use Stripe Checkout or Elements for card input (offloads PCI compliance). Handle session creation and fulfillment with API routes or Server Actions.
